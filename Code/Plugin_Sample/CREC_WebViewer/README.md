# CREC Web Viewer Plugin

CRECデータ閲覧用のWebアプリケーションプラグインです。ブラウザベースでCRECのコレクションデータを表示・検索できます。

## 概要

このプラグインは、CRECのコレクションデータをWebブラウザで閲覧するためのスタンドアロンWebアプリケーションです。

### 主な機能

- **データ閲覧**: CRECのコレクションデータをカード形式で表示
- **検索機能**: テキスト検索、カテゴリ・タグによるフィルタリング
- **在庫状況**: 在庫数と状況の表示
- **詳細表示**: コレクションの詳細情報をモーダルで表示
- **ファイル表示**: 画像ファイルの表示と他ファイルのダウンロード
- **多言語対応**: 日本語・英語の切り替え
- **レスポンシブデザイン**: モバイル・タブレット・デスクトップ対応

## 技術仕様

### フロントエンド
- **フレームワーク**: HTML5, CSS3, JavaScript (Vanilla)
- **UIライブラリ**: Bootstrap 5.3.0
- **アイコン**: Bootstrap Icons

### バックエンド
- **フレームワーク**: ASP.NET Core 8.0
- **プログラミング言語**: C#
- **配布方式**: 自己完結型実行ファイル（Self-contained）

### 対応プラットフォーム
- Windows (x64)
- Linux (x64)
- macOS (x64, ARM64)

## インストール・使用方法

### 1. ファイル配置
`publish/` フォルダ内の全てのファイルを任意の場所にコピーしてください。

### 2. データ構造

このプラグインは、以下のCRECデータ構造を読み込みます：

```
プロジェクトデータフォルダ/
├── [UUID1]/               # コレクションフォルダ（UUIDまたは任意の名前）
│   ├── index.txt         # コレクション情報ファイル（または Index.txt）
│   ├── inventory.inv     # 在庫情報ファイル（オプション）
│   └── [画像・ファイル]   # コレクションに関連するファイル
├── [UUID2]/
│   ├── index.txt
│   └── ...
└── $SystemData/          # システムフォルダ（自動的に除外されます）
```

**index.txt の形式例:**
```
名称,電子部品サンプル
ID,SAMPLE001
MC,管理コード123
登録日,2024-01-15
カテゴリ,電子部品
タグ1,Arduino
タグ2,センサー
タグ3,マイコン
場所1(Real),棚A-1
```

**注意**: `index.txt` と `Index.txt` の両方に対応しています（大文字小文字を区別しません）。

### 3. 実行方法

**重要**: このアプリケーションは、CRECのプロジェクトデータフォルダ（コレクションフォルダが入っているフォルダ）から実行する必要があります。

#### CRECプラグインとして実行（推奨）
1. CRECでプロジェクトを開く
2. メニューから「プラグイン実行(exe)」を選択
3. `CREC_WebViewer.exe` (Windows) または `CREC_WebViewer` (Linux/macOS) を選択
4. CRECが自動的にデータフォルダに移動してから実行するため、正しく動作します

#### コマンドライン引数で.crecファイルを指定
```bash
# Windows
C:\path\to\CREC_WebViewer.exe "C:\path\to\project.crec"

# Linux/macOS
/path/to/CREC_WebViewer "/path/to/project.crec"
```

この方法では、.crecプロジェクト設定ファイルを引数として渡すことで、自動的にプロジェクトのデータフォルダが読み込まれます。

#### スタンドアロン実行（データフォルダから）
```bash
# Windows
cd /path/to/crec/data/folder    # ← 必ずデータフォルダに移動してから実行
C:\path\to\CREC_WebViewer.exe

# Linux/macOS
cd /path/to/crec/data/folder    # ← 必ずデータフォルダに移動してから実行
/path/to/CREC_WebViewer
```

**注意**: `CREC_WebViewer.exe`を直接ダブルクリックしても、データフォルダから実行されない場合は正しく動作しません。必ず上記のいずれかの手順に従ってください。

### 3. アクセス方法
実行後、以下のURLでアクセスできます：
- **ローカルアクセス**: http://localhost:5000
- **ネットワークアクセス**: http://[IPアドレス]:5000

## 使用方法

### 基本操作
1. **検索**: 画面上部の検索フィルタでデータを絞り込み
2. **詳細表示**: カードの「詳細表示」ボタンをクリック
3. **ファイル表示**: 詳細画面で画像閲覧やファイルダウンロード
4. **言語切り替え**: 右上のボタンで日本語/英語を切り替え

### 検索機能
- **テキスト検索**: コレクション名、ID、タグ、コメントから検索
- **カテゴリフィルタ**: 特定のカテゴリに絞り込み
- **タグフィルタ**: タグ1〜3での絞り込み
- **在庫状況フィルタ**: 在庫状況による絞り込み

### 在庫状況表示
- 🔴 **在庫切れ**: 在庫数0
- 🟡 **在庫不足**: 在庫数少
- 🟢 **在庫適正**: 適正な在庫数
- 🔵 **在庫過剰**: 在庫数過多
- ⚪ **未設定**: 在庫管理未設定

## API仕様

### エンドポイント一覧

#### コレクション関連
- `GET /api/collections` - 全コレクション取得
- `GET /api/collections/search` - コレクション検索
- `GET /api/collections/{id}` - 特定コレクション取得
- `GET /api/collections/categories` - カテゴリ一覧取得
- `GET /api/collections/tags` - タグ一覧取得

#### ファイル関連
- `GET /api/files/{collectionId}/{fileName}` - ファイル取得

### 検索パラメータ
```
searchText: string     // テキスト検索
category: string       // カテゴリフィルタ
tag1: string          // タグ1フィルタ
tag2: string          // タグ2フィルタ
tag3: string          // タグ3フィルタ
inventoryStatus: int  // 在庫状況 (0-4)
page: int             // ページ番号
pageSize: int         // ページサイズ
```

## セキュリティ

### ファイルアクセス制限
- パストラバーサル攻撃対策
- 指定コレクションフォルダ内のファイルのみアクセス可能
- システムファイル（index.txt, comment.txt）は直接アクセス不可

### ネットワークセキュリティ
- HTTP/HTTPS対応
- CORS設定済み（全オリジン許可 - 内部ネットワーク用途）

## トラブルシューティング

### よくある問題

#### 1. 「ページが見つかりません」エラー

**原因**: `CREC_WebViewer.exe`をCRECのデータフォルダ以外の場所から実行している

**解決方法**:
1. コマンドプロンプト（またはターミナル）を開く
2. `cd`コマンドでCRECのデータフォルダ（コレクションフォルダが入っている場所）に移動
3. そのフォルダから`CREC_WebViewer.exe`を実行

```bash
# 例: Windowsの場合
cd C:\Users\YourName\Documents\CREC\MyProject_Data
C:\Tools\CREC_WebViewer\CREC_WebViewer.exe

# 例: Linux/macOSの場合
cd ~/Documents/CREC/MyProject_Data
/path/to/CREC_WebViewer
```

**推奨**: CRECのプラグインメニューから実行すると、自動的に正しいフォルダから実行されます。

#### 2. Webページが表示されない
- ポート5000が他のアプリケーションで使用されていないか確認
- ファイアウォール設定でポート5000がブロックされていないか確認

#### 2. データが表示されない
- 実行ディレクトリにCRECのindex.txtファイルがあるか確認
- コレクションフォルダの読み取り権限があるか確認

#### 3. 画像が表示されない
- 画像ファイルの形式が対応しているか確認（JPG, PNG, GIF, BMP, TIFF）
- ファイル名に特殊文字が含まれていないか確認

#### 4. 外部ネットワークからアクセスできない
- IPアドレスとポート番号が正しいか確認
- ネットワーク設定（ルーター、ファイアウォール）を確認

### ログ確認
コンソールに出力されるログで詳細なエラー情報を確認できます。

## ライセンス

このソフトウェアはMITライセンスの下で公開されています。
Copyright (c) [2025] [S.Yukisita]

## 更新履歴

### Version 1.0.0 (2025-09-30)
- 初回リリース
- 基本的なWeb閲覧機能
- 検索・フィルタリング機能
- 多言語対応（日本語・英語）
- レスポンシブデザイン

## 技術サポート

問題や要望がある場合は、CRECのGitHubリポジトリにIssueを作成してください。
https://github.com/Yukisita/CREC/issues